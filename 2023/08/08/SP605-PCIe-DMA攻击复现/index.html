<!DOCTYPE html>


<html theme="dark" showBanner="true" hasBanner="true" > 
<link href="/project/fontawesome/css/fontawesome.css" rel="stylesheet">
<link href="/project/fontawesome/css/brands.css" rel="stylesheet">
<link href="/project/fontawesome/css/solid.css" rel="stylesheet">
<script src="/project/js/color.global.min.js" ></script>
<script src="/project/js/load-settings.js" ></script>
<head>
  <meta charset="utf-8">
  
  
  <title>SP605 PCIe DMA攻击复现 | Edvison&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="基于Xilinx SP605开发板的DMA攻击工具环境搭建及工具使用过程。">
<meta property="og:type" content="article">
<meta property="og:title" content="SP605 PCIe DMA攻击复现">
<meta property="og:url" content="https://edvison.github.io/project/2023/08/08/SP605-PCIe-DMA%E6%94%BB%E5%87%BB%E5%A4%8D%E7%8E%B0/index.html">
<meta property="og:site_name" content="Edvison&#39;s blog">
<meta property="og:description" content="基于Xilinx SP605开发板的DMA攻击工具环境搭建及工具使用过程。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2022/09/01/DiulIofxWhKnBHp.png">
<meta property="og:image" content="https://s2.loli.net/2022/09/01/qKX7ie8uSaV1Gnm.png">
<meta property="og:image" content="https://s2.loli.net/2022/09/01/k2i6KYnTIw3Bl9a.png">
<meta property="og:image" content="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220920111258556.png">
<meta property="og:image" content="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220920155546198.png">
<meta property="og:image" content="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20230113150445398.png">
<meta property="og:image" content="https://s2.loli.net/2022/09/01/z1dWTnbRaKcPIBE.png">
<meta property="og:image" content="https://s2.loli.net/2022/09/01/eWN32AdrvVHFYXb.png">
<meta property="og:image" content="https://s2.loli.net/2022/09/01/JVRDBeC82rG6vKi.png">
<meta property="og:image" content="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220901111946511.png">
<meta property="og:image" content="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220901113129671.png">
<meta property="og:image" content="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220901113426994.png">
<meta property="og:image" content="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220901114016266.png">
<meta property="og:image" content="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220906091658747.png">
<meta property="og:image" content="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220906092706985.png">
<meta property="og:image" content="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220906092821022.png">
<meta property="og:image" content="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220906093107360.png">
<meta property="og:image" content="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220906093501237.png">
<meta property="og:image" content="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220906100038459.png">
<meta property="og:image" content="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220920154049156.png">
<meta property="og:image" content="https://s2.loli.net/2022/09/01/BvPgn4VQGpyWEKu.png">
<meta property="og:image" content="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220920144838507.png">
<meta property="og:image" content="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220920155546198.png">
<meta property="og:image" content="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220920145250953.png">
<meta property="og:image" content="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220920145321583.png">
<meta property="og:image" content="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220920151015447.png">
<meta property="og:image" content="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220920154229425.png">
<meta property="og:image" content="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220920154602574.png">
<meta property="og:image" content="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220920154647337.png">
<meta property="og:image" content="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220920154728814.png">
<meta property="og:image" content="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220920155005409.png">
<meta property="og:image" content="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220920155110117.png">
<meta property="og:image" content="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220920154915767.png">
<meta property="og:image" content="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220920155301967.png">
<meta property="og:image" content="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220920154929950.png">
<meta property="og:image" content="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220920155456513.png">
<meta property="og:image" content="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220920161131178.png">
<meta property="og:image" content="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20230113153205223.png">
<meta property="og:image" content="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220920173019181.png">
<meta property="og:image" content="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20230113153840172.png">
<meta property="og:image" content="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20230113154101135.png">
<meta property="og:image" content="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20230113154322267.png">
<meta property="article:published_time" content="2023-08-08T09:58:49.000Z">
<meta property="article:modified_time" content="2023-08-09T07:09:30.525Z">
<meta property="article:author" content="edvison">
<meta property="article:tag" content="pcie">
<meta property="article:tag" content="DMA攻击">
<meta property="article:tag" content="环境搭建">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2022/09/01/DiulIofxWhKnBHp.png">
  
    <link rel="alternate" href="/project/atom.xml" title="Edvison's blog" type="application/atom+xml">
  
  
    <link rel="icon" media="(prefers-color-scheme: light)" href="/project/images/favicon-light-32.png" sizes="32x32">
    <link rel="icon" media="(prefers-color-scheme: light)" href="/project/images/favicon-light-128.png" sizes="128x128">
    <link rel="icon" media="(prefers-color-scheme: light)" href="/project/images/favicon-light-180.png" sizes="180x180">
    <link rel="icon" media="(prefers-color-scheme: light)" href="/project/images/favicon-light-192.png" sizes="192x192">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/project/images/favicon-dark-32.png" sizes="32x32">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/project/images/favicon-dark-128.png" sizes="128x128">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/project/images/favicon-dark-180.png" sizes="180x180">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/project/images/favicon-dark-192.png" sizes="192x192">
  
  
<link rel="stylesheet" href="/project/css/style.css">

<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  
  
    
<div id="banner" class="">
  <img src="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/20230807175151.png" itemprop="image">
  <div id="banner-dim"></div>
</div>
 
   
  <div id="main-grid" class="shadow   ">
    <div id="nav" class=""  >
      <navbar id="navbar">
  <nav id="title-nav">
    <a href="/project/">
      <div id="vivia-logo">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>
      <div>Edvison's blog </div>
    </a>
  </nav>
  <nav id="main-nav">
    
      <a class="main-nav-link" href="/project/">Home</a>
    
      <a class="main-nav-link" href="/project/archives">Archives</a>
    
      <a class="main-nav-link" href="/project/about">About</a>
    
  </nav>
  <nav id="sub-nav">
    <a id="theme-btn" class="nav-icon">
      <span class="material-symbols-rounded light-mode-icon">wb_sunny</span>
      <span class="material-symbols-rounded dark-mode-icon">dark_mode</span>
    </a>
    
      <a id="nav-rss-link" class="nav-icon mobile-hide" href="/project/atom.xml" title="RSS 订阅">
        <span class="material-symbols-rounded rss">rss_feed</span>
      </a>
    
    <a id="nav-search-btn" class="nav-icon" title="搜索" style="display: none;">
      <span class="material-symbols-rounded">search</span>
    </a>
    <div id="nav-menu-btn" class="nav-icon">
      <span class="material-symbols-rounded">menu</span>
    </div>
  </nav>
</navbar>
<div id="nav-dropdown" class="hidden">
  <div id="dropdown-link-list">
    
      <a class="nav-dropdown-link" href="/project/">Home</a>
    
      <a class="nav-dropdown-link" href="/project/archives">Archives</a>
    
      <a class="nav-dropdown-link" href="/project/about">About</a>
    
    
      <a class="nav-dropdown-link" href="/project/atom.xml" title="RSS 订阅">RSS</a>
     
    </div>
</div>
<script>
  let dropdownBtn = document.getElementById("nav-menu-btn");
  let dropdownEle = document.getElementById("nav-dropdown");
  dropdownBtn.onclick = function() {
    dropdownEle.classList.toggle("hidden");
  }
</script>
    </div>
    <div id="sidebar-wrapper">
      <sidebar id="sidebar">
  
    <div class="widget-wrap">
  <div class="info-card">
    <div class="avatar">
      
        <image src=https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/20230808155156.png></image>
      
      <div class="img-dim"></div>
    </div>
    <div class="info">
      <div class="username">Edvison </div>
      <div class="dot"></div>
      <div class="subtitle">flung out of space </div>
      <div class="link-list">
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://github.com/Edvison" title="github"><i class="fa-brands fa-github"></i></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://weibo.com/u/6038772011" title="weibo"><i class="fa-brands fa-weibo"></i></a>
         
      </div>  
    </div>
  </div>
</div>

  
  <div class="sticky">
    
      


  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">分类</h3>
      <div class="category-box">
            <a class="category-link" href="/project/categories/UEFI%E5%8E%9F%E7%90%86/">
                UEFI原理
                <div class="category-count">3</div>
            </a>
        
            <a class="category-link" href="/project/categories/UEFI%E5%9B%BA%E4%BB%B6%E5%AE%89%E5%85%A8/">
                UEFI固件安全
                <div class="category-count">6</div>
            </a>
        
            <a class="category-link" href="/project/categories/MBR%E5%8E%9F%E7%90%86/">
                MBR原理
                <div class="category-count">2</div>
            </a>
        
            <a class="category-link" href="/project/categories/%E7%BF%BB%E8%AF%91/">
                翻译
                <div class="category-count">4</div>
            </a>
        
            <a class="category-link" href="/project/categories/Grub2%E5%8E%9F%E7%90%86/">
                Grub2原理
                <div class="category-count">1</div>
            </a>
        
            <a class="category-link" href="/project/categories/IoT%E5%AE%89%E5%85%A8/">
                IoT安全
                <div class="category-count">1</div>
            </a>
        
            <a class="category-link" href="/project/categories/%E7%A1%AC%E4%BB%B6%E5%AE%89%E5%85%A8/">
                硬件安全
                <div class="category-count">4</div>
            </a>
        
            <a class="category-link" href="/project/categories/VBIOS%E4%BF%AE%E6%94%B9/">
                VBIOS修改
                <div class="category-count">1</div>
            </a>
        </div>
    </div>
  </div>


    
      
  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">标签</h3>
      <ul class="widget-tag-list" itemprop="keywords"><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/project/tags/CSM/" rel="tag">CSM</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/project/tags/DMA%E6%94%BB%E5%87%BB/" rel="tag">DMA攻击</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/project/tags/Grub2/" rel="tag">Grub2</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/project/tags/HID%E6%94%BB%E5%87%BB/" rel="tag">HID攻击</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/project/tags/MBR/" rel="tag">MBR</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/project/tags/MBR%E5%90%8E%E9%97%A8/" rel="tag">MBR后门</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/project/tags/OS-Loader/" rel="tag">OS Loader</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/project/tags/OVMF%E7%BC%96%E8%AF%91/" rel="tag">OVMF编译</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/project/tags/PCH/" rel="tag">PCH</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/project/tags/SMM/" rel="tag">SMM</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/project/tags/SMM%E5%90%8E%E9%97%A8/" rel="tag">SMM后门</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/project/tags/SMM%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/" rel="tag">SMM漏洞分析</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/project/tags/UEFI/" rel="tag">UEFI</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/project/tags/VBIOS/" rel="tag">VBIOS</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/project/tags/pcie/" rel="tag">pcie</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/project/tags/%E5%86%99%E4%BF%9D%E6%8A%A4/" rel="tag">写保护</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/project/tags/%E5%86%99%E4%BF%9D%E6%8A%A4%E7%AA%81%E7%A0%B4/" rel="tag">写保护突破</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/project/tags/%E5%8E%9F%E7%90%86/" rel="tag">原理</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/project/tags/%E5%AE%89%E5%85%A8%E5%90%AF%E5%8A%A8/" rel="tag">安全启动</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/project/tags/%E5%BC%80%E5%8F%91%E6%9D%BF/" rel="tag">开发板</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/project/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/" rel="tag">树莓派</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/project/tags/%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/" rel="tag">漏洞分析</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/project/tags/%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/" rel="tag">漏洞利用</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/project/tags/%E6%BC%8F%E6%B4%9E%E6%89%AB%E6%8F%8F/" rel="tag">漏洞扫描</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/project/tags/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" rel="tag">环境搭建</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/project/tags/%E7%94%B5%E6%BA%90%E6%95%85%E9%9A%9C/" rel="tag">电源故障</a></li></ul>
    </div>
  </div>


    
      
  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">归档</h3>
      
      
        <a class="archive-link" href="/project/archives/2023/08 ">
          八月 2023 
          <div class="archive-count">22 </div>
        </a>
      
    </div>
  </div>


    
      
  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">最新文章</h3>
      <ul>
        
          <a class="recent-link" href="/project/2023/08/09/Lenovo%E5%9B%BA%E4%BB%B6%E4%B8%AD%E7%9A%84SMM-callout%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/" title="Lenovo固件中的SMM callout漏洞利用" >
            <div class="recent-link-text">
              Lenovo固件中的SMM callout漏洞利用
            </div>
          </a>
        
          <a class="recent-link" href="/project/2023/08/09/%E5%88%A9%E7%94%A8DMA%E6%94%BB%E5%87%BB%E7%AA%81%E7%A0%B4UEFI%E5%AE%89%E5%85%A8%E6%9C%BA%E5%88%B6/" title="利用DMA攻击突破UEFI安全机制" >
            <div class="recent-link-text">
              利用DMA攻击突破UEFI安全机制
            </div>
          </a>
        
          <a class="recent-link" href="/project/2023/08/09/UEFI-%E5%BC%95%E5%AF%BC%E8%84%9A%E6%9C%AC%E8%A1%A8%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/" title="UEFI 引导脚本表漏洞利用" >
            <div class="recent-link-text">
              UEFI 引导脚本表漏洞利用
            </div>
          </a>
        
          <a class="recent-link" href="/project/2023/08/09/%E5%9F%BA%E4%BA%8EUEFI%E5%B9%B3%E5%8F%B0%E7%9A%84SMM%E5%90%8E%E9%97%A8%E6%9E%84%E5%BB%BA/" title="基于UEFI平台的SMM后门构建" >
            <div class="recent-link-text">
              基于UEFI平台的SMM后门构建
            </div>
          </a>
        
          <a class="recent-link" href="/project/2023/08/09/P4wnP1%E9%85%8D%E7%BD%AE%E4%B8%8E%E4%BD%BF%E7%94%A8/" title="P4wnP1配置与使用" >
            <div class="recent-link-text">
              P4wnP1配置与使用
            </div>
          </a>
        
      </ul>
    </div>
  </div>

    
  </div>
</sidebar>
    </div>
    <div id="content-body">
       

<article id="post-SP605-PCIe-DMA攻击复现" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
    
   
  <div class="article-inner">
    <div class="article-main">
      <header class="article-header">
        
<div class="main-title-bar">
  <div class="main-title-dot"></div>
  
    
      <h1 class="p-name article-title" itemprop="headline name">
        SP605 PCIe DMA攻击复现
      </h1>
    
  
</div>

        <div class='meta-info-bar'>
          <div class="meta-info">
  <time class="dt-published" datetime="2023-08-08T09:58:49.000Z" itemprop="datePublished">2023-08-08</time>
</div>
          <div class="need-seperator meta-info">
            <div class="meta-cate-flex">
  
  <a class="meta-cate-link" href="/project/categories/%E7%A1%AC%E4%BB%B6%E5%AE%89%E5%85%A8/">硬件安全</a>
   
</div>
  
          </div>
          <div class="wordcount need-seperator meta-info">
            2k 词 
          </div>
        </div>
        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/project/tags/DMA%E6%94%BB%E5%87%BB/" rel="tag">DMA攻击</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/project/tags/pcie/" rel="tag">pcie</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/project/tags/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" rel="tag">环境搭建</a></li></ul>

      </header>
      <div class="e-content article-entry" itemprop="articleBody">
        
          <p>基于Xilinx SP605开发板的DMA攻击工具环境搭建及工具使用过程。</p>
<span id="more"></span>

<h1 id="开发板基本组成"><a href="#开发板基本组成" class="headerlink" title="开发板基本组成"></a>开发板基本组成</h1><p>入门手册见：<a target="_blank" rel="noopener" href="https://docs.xilinx.com/v/u/en-US/ug525">https://docs.xilinx.com/v/u/en-US/ug525</a></p>
<p>完整用户手册见：<a target="_blank" rel="noopener" href="https://www.xilinx.com/support/documentation/boards_and_kits/ug526.pdf">https://www.xilinx.com/support/documentation/boards_and_kits/ug526.pdf</a></p>
<p>完整组成为：</p>
<p><img src="https://s2.loli.net/2022/09/01/DiulIofxWhKnBHp.png" alt="image-20220901093036165"></p>
<p>我们需要关注的几个组件：</p>
<p><img src="https://s2.loli.net/2022/09/01/qKX7ie8uSaV1Gnm.png" alt="image-20220901093052106"></p>
<h2 id="SPI接口"><a href="#SPI接口" class="headerlink" title="SPI接口"></a>SPI接口</h2><p>SP605开发板搭载一个SPI接口，可通过连接JTAG接口，用Xilinx iMPACT配置工具进行固件读写。具体配置方式见</p>
<p><a target="_blank" rel="noopener" href="https://www.xilinx.com/support/documents/boards_and_kits/sp605_PCIe_Gen1_x1_pdf_xtp065_13.4.pdf">https://www.xilinx.com/support/documents/boards_and_kits/sp605_PCIe_Gen1_x1_pdf_xtp065_13.4.pdf</a></p>
<h3 id="外接编程器编程方法"><a href="#外接编程器编程方法" class="headerlink" title="外接编程器编程方法"></a>外接编程器编程方法</h3><p>其存储芯片为Winbond W25Q64BVSFIG，下面是SP605上的SPI引脚定义：</p>
<p><img src="https://s2.loli.net/2022/09/01/k2i6KYnTIw3Bl9a.png" alt="image-20220901093003624"></p>
<p>根据用户指南，要使用外部SPI跳线J17来编程SPI芯片的话，需要安装J46跳线：</p>
<p><img src="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220920111258556.png" alt="image-20220920111258556"></p>
<p>安装下面红框中的跳线：</p>
<p><img src="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220920155546198.png" alt="image-20220920155546198"></p>
<p>连接J17引脚（除VCC外）和编程器，使用开发板本身供电：<img src="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20230113150445398.png" alt="image-20230113150445398"></p>
<p>用编程器直接烧录<code>s6_pcie_microblaze.bin</code>内容。</p>
<h2 id="USB-to-UART接口"><a href="#USB-to-UART接口" class="headerlink" title="USB-to-UART接口"></a>USB-to-UART接口</h2><p>开发板包含一个Silicon Labs CP2103GM USB-to-UART bridge(U4)设备，可以通过USB线连接到主机进行调试输出。</p>
<p><img src="https://s2.loli.net/2022/09/01/z1dWTnbRaKcPIBE.png" alt="image-20220901092936948"></p>
<h2 id="LED指示灯"><a href="#LED指示灯" class="headerlink" title="LED指示灯"></a>LED指示灯</h2><p>LED灯定义表如下：</p>
<p><img src="https://s2.loli.net/2022/09/01/eWN32AdrvVHFYXb.png" alt="image-20220901092928938"></p>
<h1 id="ISE安装"><a href="#ISE安装" class="headerlink" title="ISE安装"></a>ISE安装</h1><p>安装Xilinx ISE 14.7版本，下载地址：<a target="_blank" rel="noopener" href="https://china.xilinx.com/support/download/index.html/content/xilinx/zh/downloadNav/vivado-design-tools/archive-ise.html">https://china.xilinx.com/support/download/index.html/content/xilinx/zh/downloadNav/vivado-design-tools/archive-ise.html</a></p>
<p><img src="https://s2.loli.net/2022/09/01/JVRDBeC82rG6vKi.png" alt="image-20220901105504746"></p>
<p>下载解压完成后运行<code>xsetup.exe</code>进行安装。</p>
<p>如果选择的是Win10版本，将会安装虚拟机，在虚拟机中运行ISE。</p>
<p>安装完成后，运行桌面的Project Navigator即可运行：</p>
<p><img src="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220901111946511.png" alt="image-20220901111946511"></p>
<p>虚拟机默认用户<code>ise</code>，密码<code>xilinx</code></p>
<p>安装时可以选择共享文件夹，也可以安装完成后安装VBox的增强功能，运行<code>./autorun.sh</code>脚本：</p>
<p><img src="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220901113129671.png" alt="image-20220901113129671"></p>
<p>安装完成后重启虚拟机即可在<code>设备-&gt;</code>菜单下设置共享文件夹、拖放文件、共享粘贴板功能了。</p>
<p>安装License，打开<code>Project Navigator</code>，选择<code>Help-&gt;Manage License...</code>：</p>
<p><img src="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220901113426994.png" alt="image-20220901113426994"></p>
<p>点<code>Load License...</code>，选择<code>xilinx ise 14.7 license.lic</code>文件即可激活许可证：</p>
<p><img src="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220901114016266.png" alt="image-20220901114016266"></p>
<p>激活完成后即可打开项目进行编写了：</p>
<p><img src="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220906091658747.png" alt="image-20220906091658747"></p>
<h1 id="项目编译"><a href="#项目编译" class="headerlink" title="项目编译"></a>项目编译</h1><p>在Start界面点击<code>Open Project...</code>，选择<code>s6_pcie_microblaze.xise</code>文件来打开项目。</p>
<ol>
<li>重新生成<code>s6_pcie_v2_4</code>和<code>fifo_generator_v8_4</code>的IP核：</li>
</ol>
<p>打开项目后，在Design界面下双击<code>fifo_generator_v8_4</code>：</p>
<p><img src="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220906092706985.png" alt="image-20220906092706985"></p>
<p>弹出Fifo生成器，点击<code>Generate</code>生成即可：</p>
<p><img src="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220906092821022.png" alt="image-20220906092821022"></p>
<p>同样，双击<code>s6_pcie_v2_4</code>重新生成IP核：</p>
<p><img src="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220906093107360.png" alt="image-20220906093107360"></p>
<ol start="2">
<li>选择<code>microblaze_top</code>下的<code>microblaze_i</code>实例，然后双击运行<code>Export Hardware Design To SDK with Bitstream</code>：</li>
</ol>
<p><img src="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220906093501237.png" alt="image-20220906093501237"></p>
<p>如出现以下错误：</p>
<p><img src="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220906100038459.png" alt="image-20220906100038459"></p>
<blockquote>
<p>TODO 解决此处错误</p>
</blockquote>
<p>命令行输入下面的命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ./s6_pcie_microblaze-master/ipcore_dir/s6_pcie_v2_4/s6_pcie_v2_4/implement</span><br><span class="line">./implement.sh &gt; implement.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure>

<p>该脚本会在目录下生成一系列编译文件：</p>
<p><img src="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220920154049156.png" alt="image-20220920154049156"></p>
<h3 id="iMPACT配置工具写入固件"><a href="#iMPACT配置工具写入固件" class="headerlink" title="iMPACT配置工具写入固件"></a>iMPACT配置工具写入固件</h3><p>用USB线连接USB JTAG接口和工作机：</p>
<p><img src="https://s2.loli.net/2022/09/01/BvPgn4VQGpyWEKu.png" alt="image-20220901093009119"></p>
<p>要从板载SPI闪存芯片加载比特流，需要把SW1开关设置为<code>1-ON</code>，<code>2-OFF</code>，S1设置为0000：</p>
<p><img src="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220920144838507.png" alt="image-20220920144838507"></p>
<p>J46跳线需要设置：</p>
<p><img src="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220920155546198.png"></p>
<p>打开iMPACT程序，创建一个新项目：</p>
<p><img src="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220920145250953.png" alt="image-20220920145250953"></p>
<p>选择Prepare a PROM File:</p>
<p><img src="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220920145321583.png" alt="image-20220920145321583"></p>
<p>点ok进入下一步，设置PROM文件格式，第一步选择SPI Flash - Configure Single FPGA，然后点绿箭头进入下一步，Storage Device(bits)选择64M，点击Add Storage Device，然后下一步选择输出文件名和输出文件夹，点OK完成配置：</p>
<p><img src="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220920151015447.png" alt="image-20220920151015447"></p>
<p>要求添加设备，选择刚刚编译生成的<code>./s6_pcie_microblaze-master/ipcore_dir/s6_pcie_v2_4/s6_pcie_v2_4/implement/results/routed.bit</code>文件:</p>
<p><img src="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220920154229425.png" alt="image-20220920154229425"></p>
<p>点击菜单的Operations -&gt; Generate File… 生成mcs文件：</p>
<p><img src="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220920154602574.png" alt="image-20220920154602574"></p>
<p>生成完成后双击Boundary Scan：</p>
<p><img src="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220920154647337.png" alt="image-20220920154647337"></p>
<p>菜单选择File-&gt;Initialize Chain：</p>
<p><img src="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220920154728814.png" alt="image-20220920154728814"></p>
<p>右键点”SPI&#x2F;BPI?”，点Add SPI&#x2F;BPI Flash：</p>
<p><img src="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220920155005409.png" alt="image-20220920155005409"></p>
<p>选择生成的mcs文件：</p>
<p><img src="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220920155110117.png" alt="image-20220920155110117"></p>
<p>选择SPI PROM、W25Q64BV&#x2F;CV、Data Width: 4</p>
<p><img src="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220920154915767.png" alt="image-20220920154915767"></p>
<p>右键flash图标，点Program：</p>
<p><img src="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220920155301967.png" alt="image-20220920155301967"></p>
<p>编程选项不用改，直接默认配置：</p>
<p><img src="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220920154929950.png" alt="image-20220920154929950"></p>
<p>等待编程完成：</p>
<p><img src="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220920155456513.png" alt="image-20220920155456513"></p>
<p><img src="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220920161131178.png" alt="image-20220920161131178"></p>
<p>写入SPI Flash的比特流文件包括为MicroBlaze core定制的bootloader，这个bootloader可以配置板子的选项，可通过UART接口将main程序写入linear flash中。</p>
<p>下面是将main程序写入linear flash的方法:</p>
<ol>
<li>板子连接上电源，按住SW4按钮，并打开SW2电源开关，等待DS6 LED灯亮起后松开SW4按钮，进入更新模式。</li>
<li>将USB线连接到UART接口，输入下面的命令：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># sudo pip install pyserial</span><br><span class="line"># sudo python2 ./python/bootloader_ctl.py /dev/ttyUSB0 --flash sdk/main_0/Debug/main_0.srec</span><br><span class="line"> </span><br><span class="line">[+] Opening device &quot;/dev/ttyUSB0&quot;...</span><br><span class="line">[+] Flasing 447284 bytes from &quot;sdk/main_0/Debug/main_0.srec&quot;...</span><br><span class="line">Erasing flash...</span><br><span class="line">Writing 0x100 bytes at 0x00100000</span><br><span class="line">Writing 0x100 bytes at 0x00100100</span><br><span class="line">Writing 0x100 bytes at 0x00100200</span><br><span class="line">Writing 0x100 bytes at 0x00100300</span><br><span class="line">Writing 0x100 bytes at 0x00100400</span><br><span class="line">Writing 0x100 bytes at 0x00100500</span><br><span class="line">Writing 0x100 bytes at 0x00100600</span><br><span class="line">...</span><br><span class="line">Writing 0x100 bytes at 0x0016d000</span><br><span class="line">Writing 0x100 bytes at 0x0016d100</span><br><span class="line">Writing 0x100 bytes at 0x0016d200</span><br><span class="line">Writing 0x34 bytes at 0x0016d300</span><br><span class="line">[+] DONE</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>使用下面的命令设置IP：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># sudo python2 ./python/bootloader_ctl.py /dev/ttyUSB0 --config 192.168.2.247:255.255.255.0:192.168.2.1:28472</span><br><span class="line"> </span><br><span class="line">[+] Opening device &quot;/dev/ttyUSB0&quot;...</span><br><span class="line">[+] Updating board settings...</span><br><span class="line"> </span><br><span class="line">Address: 192.168.2.247</span><br><span class="line">Netmask: 255.255.255.0</span><br><span class="line">Gateway: 192.168.2.1</span><br><span class="line">    Port: 28472</span><br><span class="line"> </span><br><span class="line">Erasing flash...</span><br><span class="line">Writing 0x12 bytes at 0x00000000</span><br><span class="line">[+] DONE</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>网线连接攻击机和开发板，退出更新模式，从linear flash中启动mian MicroBlaze程序：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># sudo python2 ./python/bootloader_ctl.py /dev/ttyUSB0 --boot</span><br><span class="line">[+] Opening device &quot;/dev/ttyUSB0&quot;...</span><br><span class="line">[+] Exitting from update mode...</span><br><span class="line"> </span><br><span class="line">SREC Bootloader</span><br><span class="line">Loading SREC image from flash at address: 42000000</span><br><span class="line">Executing program starting at address: 00000000</span><br><span class="line">main()</span><br><span class="line">Loading settings from flash...</span><br><span class="line">[+] Address: 192.168.2.247</span><br><span class="line">[+] Netmask: 255.255.255.0</span><br><span class="line">[+] Gateway: 192.168.2.1</span><br><span class="line">auto-negotiated link speed: 100</span><br><span class="line">Option ROM support is present</span><br><span class="line">Initializing DMA...</span><br><span class="line">Initializing interrupts...</span><br><span class="line">start_application(): TCP server is started at port 28472</span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<ol start="5">
<li><p>将SP605插入目标机的PCI-E插槽，打开开发板电源开关，待DS5 LED灯亮起后打开目标机电源，可以看到DS3、DS4 LED灯亮起，说明PCI-E成功连接：<img src="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20230113153205223.png" alt="image-20230113153205223"></p>
</li>
<li><p>目标机上运行lspci命令，可以看到Xilinx PCI-E设备：</p>
</li>
</ol>
<p><img src="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20220920173019181.png" alt="image-20220920173019181"></p>
<h1 id="开发工具包使用"><a href="#开发工具包使用" class="headerlink" title="开发工具包使用"></a>开发工具包使用</h1><h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3><p>安装依赖：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 -m pip install pefile</span><br></pre></td></tr></table></figure>

<p>在攻击机上配置<code>python\pcie_lib_config.py</code>文件中的IP和端口，与上述更新模式中配置的IP一致即可：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line">DEVICE_TYPE_TCP             = <span class="number">1</span></span><br><span class="line">DEVICE_TYPE_SERIAL          = <span class="number">2</span></span><br><span class="line">DEVICE_TYPE_UIO             = <span class="number">3</span></span><br><span class="line">DEVICE_TYPE_DRIVER          = <span class="number">4</span></span><br><span class="line">DEVICE_TYPE_DRIVER_DIRECT   = <span class="number">5</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Conf</span>:</span><br><span class="line"> </span><br><span class="line">    device_type = DEVICE_TYPE_TCP</span><br><span class="line"> </span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># DEVICE_TYPE_SERIAL options</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># serial port device</span></span><br><span class="line">    device = <span class="string">&#x27;/dev/ttyUSB0&#x27;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># serial port baudrate</span></span><br><span class="line">    baud = <span class="number">115200</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># DEVICE_TYPE_TCP options</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># board IP address and port</span></span><br><span class="line">    addr = ( <span class="string">&#x27;192.168.2.247&#x27;</span>, <span class="number">28472</span> )</span><br><span class="line"> </span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># EoF</span></span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>工具包提供两个环境变量可覆盖某些选项的默认值：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DEBUG_TLP : 设置为1，则打印TX、RX TLP数据包到屏幕输出中</span><br><span class="line">TARGET_ADDR: &lt;ip addr&gt;:&lt;port&gt;，该环境变量可覆盖pcie_lib_config.py文件中的配置</span><br></pre></td></tr></table></figure>

<p>攻击机上运行命令<code>python2 pcie_cfg.py</code>，可查看PCI-E设备的配置空间寄存器：</p>
<p><img src="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20230113153840172.png" alt="image-20230113153840172"></p>
<p>使用<code>pcie_mem.py</code>程序可读取目标机的物理内存，下例为从0x0地址开始，读取0x80个字节的物理内存：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DEBUG_TLP=1 python2 pcie_mem.py 0x0 0x80</span><br></pre></td></tr></table></figure>

<p><img src="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20230113154101135.png" alt="image-20230113154101135"></p>
<p>也可将物理内存转储到文件中：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 pcie_mem.py 0x18000000 0x200 dump.bin</span><br></pre></td></tr></table></figure>

<p><img src="https://myimage-1254411429.cos.ap-chengdu.myqcloud.com/image-20230113154322267.png" alt="image-20230113154322267"></p>
<h3 id="DMA预引导攻击"><a href="#DMA预引导攻击" class="headerlink" title="DMA预引导攻击"></a>DMA预引导攻击</h3><p><code>uefi_backdoor_simple.py</code>、<code>uefi_backdoor_hv.py</code>、<code>uefi_backdoor_boot.py</code>和<code>uefi_backdoor_boot_shell.py</code>支持两种不同的方式来传递执行到注入的UEFI DXE驱动镜像:</p>
<ul>
<li><code>EFI_SYSTEM_TABLE</code>劫持 - 从物理地址0xF0000000到0向下扫描系统内存，每次0x10000字节，通过EFI系统表的签名找到<code>EFI_SYSTEM_TABLE</code>，并patch <code>LocateProtocol()</code>函数地址。可以使用SCAN_FROM和SCAN_STEP环境变量来覆盖内存扫描选项。</li>
<li><code>PROTOCOL_ENTRY</code>劫持 - 从物理地址0x76000000到0xA0000000向上扫描系统内存，每次0x1000字节，找到CPU I&#x2F;O 2协议的<code>EFI_CPU_IO2_PROTOCOL</code>结构，然后patch该结构中的一个函数。可以使用SCAN_FROM、SCAN_TO和SCAN_STEP环境变量来覆盖内存扫描选项。</li>
</ul>
<p>默认情况下，所有四个程序都使用EFI系统表劫持方法，如果要使用<code>PROTOCOL_ENTRY</code>方法，可以使用<code>--inj-prot</code>命令行选项。<br>为了减少执行攻击所需的时间，可以在<code>EFI_SYSTEM_TABLE</code>劫持时使用<code>--system-table</code>选项指定先前找到的<code>EFI_SYSTEM_TABLE</code>结构地址，或在<code>PROTOCOL_ENTRY</code>劫持时使用<code>--prot-entry</code>选项指定<code>PROTOCOL_ENTRY</code>结构地址。</p>
<p>另外，所有四个Python程序都有<code>--test</code>命令行选项，这个选项用于进行内存扫描，找到所需的结构地址，但不执行实际的劫持流程。在首次运行时，可以用<code>--test</code>选项运行所需的程序来找到所需的地址，第二次运行时再用<code> --system-table</code>或<code>--prot-entry</code>选项运行相同的程序来指定该地址。</p>

        
      </div>

         
    </div>
    
     
  </div>
  
    
<nav id="article-nav">
  <a class="article-nav-btn left "
    
      href="/project/2023/08/09/Xilinx-SP605%E7%94%B5%E8%B7%AF%E6%9D%BF%E6%95%85%E9%9A%9C%E8%B0%83%E8%AF%95/"
      title="Xilinx SP605电路板故障调试"
     >
    <i class="fa-solid fa-angle-left"></i>
    <p class="title-text">
      
        Xilinx SP605电路板故障调试
        
    </p>
  </a>
  <a class="article-nav-btn right "
    
      href="/project/2023/08/08/PCIe-TLP%E6%95%B0%E6%8D%AE%E5%8C%85%E5%8E%9F%E7%90%86/"
      title="PCIe TLP数据包原理"
     >

    <p class="title-text">
      
        PCIe TLP数据包原理
        
    </p>
    <i class="fa-solid fa-angle-right"></i>
  </a>
</nav>


  
</article>


  
  <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
  <div id="comment-card" class="comment-card">
    <div class="main-title-bar">
      <div class="main-title-dot"></div>
      <div class="main-title">留言 </div>
    </div>
    <div id="vcomments"></div>
  </div>
  <script>
      new Valine({"enable":true,"appId":"bC8HOSKa4QB7G6TfuGWB97i4-gzGzoHsz","appKey":"aoDFuSX5vWN8Xn1ukZpJ50be","placeholder":"写下你的评论...","pageSize":10,"highlight":true,"serverURLs":null,"el":"#vcomments"});
  </script>
 
    </div>
    <div id="footer-wrapper">
      <footer id="footer">
  
  <div id="footer-info" class="inner">
    
    &copy; 2023 Edvison<br>
    Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & Theme <a target="_blank" rel="noopener" href="https://github.com/saicaca/hexo-theme-vivia">Vivia</a>
  </div>
</footer>

    </div>
    <div class="back-to-top-wrapper">
    <button id="back-to-top-btn" class="back-to-top-btn" onclick="topFunction()">
        <span class="material-symbols-rounded">keyboard_arrow_up</span>
    </button>
</div>

<script>
    function topFunction() {
        window.scroll({ top: 0, behavior: 'smooth' });
    }
    let btn = document.getElementById('back-to-top-btn');
    function scrollFunction() {
        if (document.body.scrollTop > 600 || document.documentElement.scrollTop > 600) {
            btn.style.opacity = 1;
        } else {
            btn.style.opacity = 0;
        }
    }
    window.onscroll = function() {
        scrollFunction();
    }
</script>

  </div>
  <script src="/project/js/light-dark-switch.js"></script>
</body>
</html>
